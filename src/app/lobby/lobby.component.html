<div class="container">
  <h1 *ngIf="!gameCode">Multiplayer</h1>

  <div *ngIf="!gameCode">
    <button mat-raised-button color="primary" (click)="createGame()">
      Create New Game
    </button>

    <h4>or</h4>
    <form [formGroup]="joinGameForm">
      <mat-form-field>
        <input
          matInput
          formControlName="gameCode"
          placeholder="Enter room code"
          (input)="onInputChange($event)"
          maxlength="4"
        />
        <mat-error
          *ngIf="
            joinGameForm.get('gameCode')!.invalid &&
            joinGameForm.get('gameCode')!.touched
          "
        >
          Please input a valid room code
        </mat-error>
      </mat-form-field>
      <br />
      <button
        mat-raised-button
        color="accent"
        [disabled]="!joinGameForm.valid"
        (click)="joinGame()"
      >
        Join Game
      </button>
      <br />
    </form>
  </div>

  <div *ngIf="gameCode">
    <h2>Room code: {{ gameCode }}</h2>

    <div class="mt-4">
      <h3 class="text-lg font-semibold mb-2">Invite link:</h3>
      <div class="d-flex link-container" (click)="copyToClipboard()">
        <div class="url">{{ getDisplayUrl() }}</div>
        <i
          class="copy-icon"
          [ngClass]="
            isCopied ? 'fa-regular fa-circle-check' : 'fa-regular fa-copy'
          "
        ></i>
      </div>
    </div>
    <div class="player-grid">
      <div *ngFor="let player of players; let i = index" class="player-card">
        <i
          [ngClass]="{ transparent: !player.isHost }"
          class="fa-solid fa-crown crown"
        ></i>
        <div [ngStyle]="getBackgroundColor(i)" class="player-avatar"></div>
        <div class="player-name">
          <ng-container *ngIf="!isPlayerSelf(player) || !editingName">
            {{ player.displayName }}
            <i
              *ngIf="isPlayerSelf(player)"
              (click)="editName()"
              (blur)="submitName()"
              class="fa-solid fa-pencil pencil"
            ></i>
          </ng-container>
          <ng-container *ngIf="isPlayerSelf(player) && editingName">
            <input
              [value]="player.displayName"
              (input)="onNameInputChange($event)"
              (blur)="submitName()"
              (keyup.enter)="submitName()"
              maxlength="20"
              #nameInput
            />
          </ng-container>
        </div>
        <div
          class="player-status"
          [ngClass]="{ ready: player.ready, 'not-ready': !player.ready }"
        >
          <div
            *ngIf="
              !isPlayerSelf(player) || (isPlayerSelf(player) && player.ready)
            "
          >
            {{ player.ready ? "Ready" : "Not ready" }}
          </div>
          <button
            class="btn btn-primary"
            *ngIf="isPlayerSelf(player) && !player.ready"
            (click)="readyUp()"
          >
            Ready
          </button>
        </div>
      </div>
    </div>

    <button
      mat-raised-button
      color="primary"
      *ngIf="isHost"
      (click)="startGame()"
      [disabled]="anyNotReady() || players.length < 2"
    >
      Start Game
    </button>
  </div>
</div>
