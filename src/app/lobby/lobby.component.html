<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-6 text-center">
      <h1 *ngIf="!gameCode" class="mb-4">Versus</h1>

      <div *ngIf="!gameCode">
        <button class="btn btn-primary btn-lg mb-3" (click)="createGame()">
          Create New Game
        </button>

        <hr />

        <form [formGroup]="joinGameForm">
          <div class="form-group">
            <input
              class="form-control form-control-lg mx-auto mb-3"
              style="max-width: 185px; font-size: 20px"
              formControlName="gameCode"
              placeholder="Enter room code"
              (input)="onInputChange($event)"
              maxlength="4"
            />
            <div
              class="invalid-feedback"
              *ngIf="
                joinGameForm.get('gameCode')!.invalid &&
                joinGameForm.get('gameCode')!.touched
              "
            >
              Please input a valid room code
            </div>
          </div>
          <button
            class="btn btn-secondary"
            [disabled]="!joinGameForm.valid"
            (click)="joinGameClick()"
          >
            Join Game
          </button>
        </form>
      </div>

      <div *ngIf="gameCode">
        <h2>Room code: {{ gameCode }}</h2>

        <div class="mt-4">
          <h3 class="text-lg font-semibold mb-2">Invite link:</h3>
          <div
            class="d-flex link-container m-lr-auto"
            (click)="copyToClipboard()"
          >
            <div class="url">{{ getDisplayUrl() }}</div>
            <i
              class="copy-icon"
              [ngClass]="
                isCopied ? 'fa-regular fa-circle-check' : 'fa-regular fa-copy'
              "
            ></i>
          </div>
        </div>
        <div class="player-grid">
          <div
            *ngFor="let player of players; let i = index"
            class="player-card"
          >
            <i
              [ngClass]="{ transparent: !player.isHost }"
              class="fa-solid fa-crown crown"
            ></i>
            <div [ngStyle]="getBackgroundColor(i)" class="player-avatar"></div>
            <div class="player-name">
              <ng-container *ngIf="!isPlayerSelf(player) || !editingName">
                {{ player.displayName }}
                <i
                  *ngIf="isPlayerSelf(player)"
                  (click)="editName()"
                  (blur)="submitName()"
                  class="fa-solid fa-pencil pencil"
                ></i>
              </ng-container>
              <ng-container *ngIf="isPlayerSelf(player) && editingName">
                <input
                  [value]="player.displayName"
                  (input)="onNameInputChange($event)"
                  (blur)="submitName()"
                  (keyup.enter)="submitName()"
                  maxlength="20"
                  #nameInput
                />
              </ng-container>
            </div>
            <div
              class="player-status"
              [ngClass]="{ ready: player.ready, 'not-ready': !player.ready }"
            >
              <div
                *ngIf="
                  !isPlayerSelf(player) ||
                  (isPlayerSelf(player) && player.ready)
                "
              >
                <div *ngIf="player.ready">
                  <button class="btn btn-outline-success" disabled>
                    Ready
                  </button>
                </div>
                <div *ngIf="!player.ready">
                  <button class="btn btn-outline-danger" disabled>
                    Not Ready
                  </button>
                </div>
              </div>
              <button
                class="btn btn-success"
                *ngIf="isPlayerSelf(player) && !player.ready"
                (click)="readyUp()"
              >
                Ready
              </button>
            </div>
          </div>
        </div>

        <button
          class="btn btn-lg btn-primary mt-4"
          color="primary"
          *ngIf="isHost"
          (click)="startGame()"
          [disabled]="anyNotReady() || players.length < 2"
        >
          Start Game
        </button>
      </div>
    </div>
  </div>
</div>
